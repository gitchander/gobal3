package ternary

//------------------------------------------------------------------------------

// http://homepage.divms.uiowa.edu/%7Ejones/ternary/arith.shtml

// Add table

// +----+----+----+----+
// |    |  T |  0 |  1 |
// +----+----+----+----+
// |  T | T1 |  T |  0 |
// +----+----+----+----+
// |  0 |  T |  0 |  1 |
// +----+----+----+----+
// |  1 |  0 |  1 | 1T |
// +----+----+----+----+

//------------------------------------------------------------------------------

// Sum table:

// +---+---+---+---+
// |   | T | 0 | 1 |
// +---+---+---+---+
// | T | 1 | T | 0 |
// +---+---+---+---+
// | 0 | T | 0 | 1 |
// +---+---+---+---+
// | 1 | 0 | 1 | T |
// +---+---+---+---+

func sum(a, b int) int {

	// _, lo := tritsSumSplit(a + b)
	// return lo

	//--------------------------------------------------------------------------

	// (a + b) = ((a = -1) ∧ (b - 1)) ∨ ((a = 0) ∧ (b)) ∨ ((a = +1) ∧ (b + 1))
	// where:
	// ∧ - min
	// ∨ - max
	// (b - 1) - dec(b)
	// (b + 1) - inc(b)

	var (
		v1 = min(TritIs(a, -1), tritDec(b))
		v2 = min(TritIs(a, 0), b)
		v3 = min(TritIs(a, +1), tritInc(b))
	)

	return max(v1, max(v2, v3))
}

//------------------------------------------------------------------------------

// Consider table:

// +---+---+---+---+
// |   | T | 0 | 1 |
// +---+---+---+---+
// | T | T | 0 | 0 |
// +---+---+---+---+
// | 0 | 0 | 0 | 0 |
// +---+---+---+---+
// | 1 | 0 | 0 | 1 |
// +---+---+---+---+

func cons(a, b int) int {
	return max(min(0, max(a, b)), min(a, b))
}

//------------------------------------------------------------------------------

// A balanced ternary half adder

// c0 - carryIn
// c1 - carryOut

func halfAdder(a, c0 int) (s, c1 int) {
	s = sum(a, c0)
	c1 = cons(a, c0)
	return
}

//------------------------------------------------------------------------------

// Balanced Full Adder

// c0 - carryIn
// c1 - carryOut

func FullAdder(a, b, c0 int) (s, c1 int) {
	var (
		s1, x1 = halfAdder(a, b)
		s2, x2 = halfAdder(s1, c0)
		s3, _  = halfAdder(x1, x2)
	)
	s = s2
	c1 = s3
	return
}

//------------------------------------------------------------------------------
